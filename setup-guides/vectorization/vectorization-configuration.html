<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Configuring vectorization | FoundationaLLM </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Configuring vectorization | FoundationaLLM ">
      
      
      <link rel="icon" href="../../media/favicon.ico">
      <link rel="stylesheet" href="../../public/docfx.min.css">
      <link rel="stylesheet" href="../../public/main.css">
      <meta name="docfx:navrel" content="../../toc.html">
      <meta name="docfx:tocrel" content="../../toc.html">
      
      <meta name="docfx:rel" content="../../">
      
      
      <meta name="docfx:docurl" content="https://github.com/solliancenet/foundationallm/blob/main/docs/setup-guides/vectorization/vectorization-configuration.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../../index.html">
            <img id="logo" class="svg" src="../../media/fllm-icon.svg" alt="FoundationaLLM">
            FoundationaLLM
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="configuring-vectorization">Configuring vectorization</h1>

<p>This section provides details on how to configure the vectorization API and workers in FoundationaLLM.</p>
<div class="NOTE">
<h5>Note</h5>
<p>These configurations should already be in place if you deployed FoundationaLLM (FLLM) using the recommended deployment scripts.
The details presented here are provided for cases in which you need to troubleshoot or customize the configuration.</p>
</div>
<h2 id="configuration-for-vectorization-api">Configuration for Vectorization API</h2>
<p>The following table describes the Azure artifacts required for the vectorization pipelines.</p>
<table>
<thead>
<tr>
<th>Artifact name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>vectorization-input</code></td>
<td>Azure storage container used by default to store documents to be picked up by the vectorization pipeline. Must be created on a Data Lake storage account (with the hierarchical namespace enabled).</td>
</tr>
</tbody>
</table>
<p>The following table describes the environment variables required for the vectorization pipelines.</p>
<table>
<thead>
<tr>
<th>Environment variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM_AppConfig_ConnectionString</code></td>
<td>Connection string to the Azure App Configuration instance.</td>
</tr>
</tbody>
</table>
<p>The following table describes the required configuration parameters for the vectorization pipelines.</p>
<table>
<thead>
<tr>
<th>App Configuration Key</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM:APIs:VectorizationAPI:APIUrl</code></td>
<td></td>
<td>The URL of the vectorization API.</td>
</tr>
<tr>
<td><code>FoundationaLLM:APIs:VectorizationAPI:APIKey</code></td>
<td>Key Vault secret name: <code>foundationallm-apis-vectorizationapi-apikey</code></td>
<td>The API key of the vectorization API.</td>
</tr>
<tr>
<td><code>FoundationaLLM:APIs:VectorizationAPI:AppInsightsConnectionString</code></td>
<td>Key Vault secret name: <code>foundationallm-app-insights-connection-string</code></td>
<td>The connection string to the Application Insights instance used by the vectorization API.</td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>Refer to the <a href="../../deployment/app-configuration-values.html">App Configuration values</a> page for more information on how to set these and other configuration values.</p>
</div>
<h2 id="configuration-for-vectorization-workers">Configuration for Vectorization workers</h2>
<p>The following table describes the Azure artifacts required for the vectorization pipelines.</p>
<table>
<thead>
<tr>
<th>Artifact Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>embed</code></td>
<td>Azure storage queue used for the embed vectorization pipeline. Can be created on the storage account used for the other queues.</td>
</tr>
<tr>
<td><code>extract</code></td>
<td>Azure storage queue used for the extract vectorization pipeline. Can be created on the storage account used for the other queues.</td>
</tr>
<tr>
<td><code>index</code></td>
<td>Azure storage queue used for the index vectorization pipeline. Can be created on the storage account used for the other queues.</td>
</tr>
<tr>
<td><code>partition</code></td>
<td>Azure storage queue used for the partition vectorization pipeline. Can be created on the storage account used for the other queues.</td>
</tr>
<tr>
<td><code>vectorization-state</code></td>
<td>Azure storage container used for the vectorization state service. Can be created on the storage account used for the other queues.</td>
</tr>
<tr>
<td><code>resource-provider</code></td>
<td>Azure storage container used for the internal states of the FoundationaLLM resource providers.</td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.Vectorization/vectorization-pipelines.json</code></td>
<td>Azure storage blob used for the vectorization pipeline resources managed by the <code>FoundationaLLM.Vectorization</code> resource provider. For more details, see <a href="vectorization-concepts.html#vectorization-pipelines">vectorization pipelines</a>.</td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.Vectorization/vectorization-text-partitioning-profiles.json</code></td>
<td>Azure storage blob used for the text partitioning profiles managed by the <code>FoundationaLLM.Vectorization</code> resource provider. For more details, see <a href="vectorization-profiles.html#text-partitioning-profiles">vectorization text partitioning profiles</a>.</td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.Vectorization/vectorization-text-embedding-profiles.json</code></td>
<td>Azure storage blob used for the text embedding profiles managed by the <code>FoundationaLLM.Vectorization</code> resource provider. For more details, see <a href="vectorization-profiles.html#text-embedding-profiles">vectorization text embedding profiles</a>.</td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.Vectorization/vectorization-indexing-profiles.json</code></td>
<td>Azure storage blob used for the indexing profiles managed by the <code>FoundationaLLM.Vectorization</code> resource provider. For more details, see <a href="vectorization-profiles.html#indexing-profiles">vectorization indexing profiles</a>.</td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.DataSources</code></td>
<td>Azure storage directory where the data sources managed by the <code>FoundationaLLM.DataSources</code> resource provider are stored.</td>
</tr>
<tr>
<td><code>vectorization-state/requests/{requestid-yyyyMMdd}.json</code></td>
<td>Azure storage directory where vectorization requests managed by the vectorization state service are stored.</td>
</tr>
<tr>
<td><code>vectorization-state/execution-state/{canonical_id}</code></td>
<td>Azure storage directory where the execution state of the vectorization requests and their resulting artifacts are stored. The canonical_id is defined in the vectorization request.</td>
</tr>
<tr>
<td><code>vectorization-state/pipeline-state/{pipeline_name}/{pipeline_name}-{execution_id}.json</code></td>
<td>Azure storage directory where the state of the vectorization pipeline execution is stored. The pipeline_name is the name of the vectorization pipeline and the execution_id is the unique identifier of the execution.</td>
</tr>
</tbody>
</table>
<p>The following table describes the environment variables required for the vectorization pipelines.</p>
<table>
<thead>
<tr>
<th>Environment variable</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM_AppConfig_ConnectionString</code></td>
<td>Connection string to the Azure App Configuration instance.</td>
</tr>
</tbody>
</table>
<p>The following table describes the required App Configuration parameters for the vectorization pipelines.</p>
<table>
<thead>
<tr>
<th>App Configuration Key</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM:APIs:VectorizationWorker:APIUrl</code></td>
<td></td>
<td>The URL of the vectorization worker API.</td>
</tr>
<tr>
<td><code>FoundationaLLM:APIs:VectorizationWorker:APIKey</code></td>
<td>Key Vault secret name: <code>foundationallm-apis-vectorizationworker-apikey</code></td>
<td>The API key of the vectorization worker API.</td>
</tr>
<tr>
<td><code>FoundationaLLM:APIs:VectorizationWorker:AppInsightsConnectionString</code></td>
<td>Key Vault secret name: <code>foundationallm-app-insights-connection-string</code></td>
<td>The connection string to the Application Insights instance used by the vectorization worker API.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:VectorizationWorker</code></td>
<td></td>
<td>The settings used by each instance of the vectorization worker service. For more details, see <a href="#default-vectorization-worker-settings">default vectorization worker settings</a>.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:Queues:Embed:AccountName</code></td>
<td></td>
<td>The account name of the Azure Storage account used for the embed vectorization queue.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:Queues:Extract:AccountName</code></td>
<td></td>
<td>The account name of the Azure Storage account used for the extract vectorization queue.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:Queues:Index:AccountName</code></td>
<td></td>
<td>The account name of the Azure Storage account used for the index vectorization queue.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:Queues:Partition:AccountName</code></td>
<td></td>
<td>The account name of the Azure Storage account used for the partition vectorization queue.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:StateService:Storage:AuthenticationType</code></td>
<td></td>
<td>The authentication type used to connect to the underlying storage. Can be one of <code>AzureIdentity</code>, <code>AccountKey</code>, or <code>ConnectionString</code>.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:ResourceProviderService:Storage:AuthenticationType</code></td>
<td></td>
<td>The authentication type used to connect to the underlying storage. Can be one of <code>AzureIdentity</code>, <code>AccountKey</code>, or <code>ConnectionString</code>.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:SemanticKernelTextEmbeddingService:APIKey</code></td>
<td>Key Vault secret name: <code>foundationallm-vectorization-semantickerneltextembedding-openai-apikey</code></td>
<td>The API key used to connect to the Azure OpenAI service.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:SemanticKernelTextEmbeddingService:AuthenticationType</code></td>
<td></td>
<td>The authentication type used to connect to the Azure OpenAI service. Can be one of <code>AzureIdentity</code> or <code>APIKey</code>.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:SemanticKernelTextEmbeddingService:DeploymentName</code></td>
<td></td>
<td>The name of the Azure OpenAI model deployment. The default value is <code>embeddings</code>.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:SemanticKernelTextEmbeddingService:Endpoint</code></td>
<td></td>
<td>The endpoint of the Azure OpenAI service.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:AzureAISearchIndexingService:APIKey</code></td>
<td>Key Vault secret name: <code>foundationallm-vectorization-azureaisearch-apikey</code></td>
<td>The API key used to connect to the Azure OpenAI service.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:AzureAISearchIndexingService:AuthenticationType</code></td>
<td></td>
<td>The authentication type used to connect to the Azure OpenAI service. Can be one of <code>AzureIdentity</code> or <code>APIKey</code>.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Vectorization:AzureAISearchIndexingService:Endpoint</code></td>
<td></td>
<td>The endpoint of the Azure OpenAI service.</td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>Refer to the <a href="../../app-configuration-values.md">App Configuration values</a> page for more information on how to set these and other configuration values.</p>
</div>
<p>The following table describes the external content used by the vectorization worker to initialize:</p>
<table>
<thead>
<tr>
<th>Uri</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>https://openaipublic.blob.core.windows.net/encodings/cl100k_base.tiktoken</code></td>
<td>The public Azure Blob Storage account used to download the OpenAI BPE ranking files.</td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>The vectorization worker must be able to open HTTPS connections to the external content listed above.</p>
</div>
<h3 id="default-vectorization-worker-settings">Default vectorization worker settings</h3>
<p>The default settings for the vectorization worker are stored in the <code>FoundationaLLM:Vectorization:VectorizationWorker</code> App Configuration key. The default structure for this key is:</p>
<pre><code class="lang-json">{
    &quot;RequestManagers&quot;: [
        {
            &quot;RequestSourceName&quot;: &quot;extract&quot;,
            &quot;MaxHandlerInstances&quot;: 1,
            &quot;QueueProcessingPace&quot;: 5,
            &quot;QueuePollingInterval&quot;: 60,
            &quot;QueueMaxNumberOfRetries&quot;: 5
        },
        {
            &quot;RequestSourceName&quot;: &quot;partition&quot;,
            &quot;MaxHandlerInstances&quot;: 1,
            &quot;QueueProcessingPace&quot;: 5,
            &quot;QueuePollingInterval&quot;: 60,
            &quot;QueueMaxNumberOfRetries&quot;: 5
        },
        {
            &quot;RequestSourceName&quot;: &quot;embed&quot;,
            &quot;MaxHandlerInstances&quot;: 1,
            &quot;QueueProcessingPace&quot;: 5,
            &quot;QueuePollingInterval&quot;: 60,
            &quot;QueueMaxNumberOfRetries&quot;: 5
        },
        {
            &quot;RequestSourceName&quot;: &quot;index&quot;,
            &quot;MaxHandlerInstances&quot;: 1,
            &quot;QueueProcessingPace&quot;: 5,
            &quot;QueuePollingInterval&quot;: 60,
            &quot;QueueMaxNumberOfRetries&quot;: 5
        }
    ],
    &quot;RequestSources&quot;: [
        {
            &quot;Name&quot;: &quot;extract&quot;,
            &quot;AccountName&quot;: &quot;{{accountName}}&quot;,
            &quot;VisibilityTimeoutSeconds&quot;: 600
        },
        {
            &quot;Name&quot;: &quot;partition&quot;,
            &quot;AccountName&quot;: &quot;{{accountName}}&quot;,
            &quot;VisibilityTimeoutSeconds&quot;: 600
        },
        {
            &quot;Name&quot;: &quot;embed&quot;,
            &quot;AccountName&quot;: &quot;{{accountName}}&quot;,
            &quot;VisibilityTimeoutSeconds&quot;: 600
        },
        {
            &quot;Name&quot;: &quot;index&quot;,
            &quot;AccountName&quot;: &quot;{{accountName}}&quot;,
            &quot;VisibilityTimeoutSeconds&quot;: 600
        }
    ],
    &quot;QueuingEngine&quot;: &quot;AzureStorageQueue&quot;
}
</code></pre>
<p>The following table provides details about the configuration parameters:</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>RequestManagers</code></td>
<td>The list of request managers used by the vectorization worker. Each request manager is responsible for managing the execution of vectorization pipelines for a specific vectorization step. The configuration must include all request managers.</td>
</tr>
<tr>
<td><code>RequestManagers.MaxHandlerInstances</code></td>
<td>The maximum number of request handlers that process requests for the specified request source. By default, the value is 1. You can change the value to increase the processing capacity of each vectorization worker instance. The value applies to all istances of the vectorization worker. NOTE: It is important to align the value of this setting with the level of compute and memory resources allocated to the individual vectorization worker instances.</td>
</tr>
<tr>
<td><code>RequestManagers.QueueProcessingPace</code></td>
<td><strong>Optional</strong> The delay in seconds to wait between requests after a request has been processed. The default value is 5.</td>
</tr>
<tr>
<td><code>RequestManagers.QueuePollingInterval</code></td>
<td><strong>Optional</strong> The polling interval in seconds, this is the amount of time to wait if the previous check on the queue had no items. The default value is 60.</td>
</tr>
<tr>
<td><code>RequestManagers.QueueMaxNumberOfRetries</code></td>
<td><strong>Optional</strong> The maximum number of retries to attempt to process a request before being removed from the queue. The default value is 5.</td>
</tr>
<tr>
<td><code>RequestSources</code></td>
<td>The list of request sources used by the vectorization worker. Each request source is responsible for managing the requests for a specific vectorization step. The configuration must include all request sources.</td>
</tr>
<tr>
<td><code>RequestSources.Name</code></td>
<td>The name of the request source. The name must match the name of the request manager.</td>
</tr>
<tr>
<td><code>RequestSources.AccountName</code></td>
<td>The name of the configuration key for the Azure Storage account used for the queue (include the tokens after <strong>FoundationaLLM:Vectorization:Queues:</strong>).</td>
</tr>
<tr>
<td><code>RequestSources.VisibilityTimeoutSeconds</code></td>
<td>In the case of queue-based request sources (the default for the vectorization worker), specifies the time in seconds until a dequeued vectorization step request must be executed. During this timeout, the message will not be visible to other handler instances within the same worker or from other worker instances. If the handler fails to process the vectorization step request successfully and remove it from the queue within the specified timeout, the message will become visibile again. The default value is 600 seconds and should not be changed.</td>
</tr>
</tbody>
</table>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/solliancenet/foundationallm/blob/main/docs/setup-guides/vectorization/vectorization-configuration.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © FoundationaLLM. All rights reserved. | Find out more about FoundationaLLM at <a href="https://foundationallm.ai">foundationallm.ai</a>.
        </div>
      </div>
    </footer>
  </body>
</html>
