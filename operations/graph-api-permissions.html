<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>Why FoundationaLLM needs Graph API permissions | FoundationaLLM </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="Why FoundationaLLM needs Graph API permissions | FoundationaLLM ">
      
      
      <link rel="icon" href="../media/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/foundationallm/foundationallm/blob/main/docs/operations/graph-api-permissions.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../media/fllm-icon.svg" alt="FoundationaLLM">
            FoundationaLLM
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="why-foundationallm-needs-graph-api-permissions">Why FoundationaLLM needs Graph API permissions</h1>

<h2 id="summary">Summary</h2>
<p>A fully functional, robust, and scalable Role-Based Access Control (RBAC) implementation is critical for the success of any enterprise software platform. This is especially true with Generative AI platforms where the new ways in which data is transported, processed, and transformed must be secured and governed.</p>
<p>A fully functional RBAC implementation relies on capabilities provided by the underlying identity management platform like:</p>
<ul>
<li>Enumeration of users, groups, and security principals</li>
<li>Mapping of object identifiers to their display names</li>
<li>Identification of security groups membership.</li>
</ul>
<p>The RBAC implementation provided by FoundationaLLM is designed from the ground up to provide the necessary security layers required by a Generative AI platform deployed in the enterprise. For transparency and auditing purposes, FoundationaLLM keeps all its source code out in the open (in a public GitHub repository) allowing all of the claims made about the behavior of the code to be validated and confirmed by any interested party.</p>
<h2 id="context">Context</h2>
<p>Graph API permissions are required for the managed identities of the two surface APIs of the platform:</p>
<ul>
<li>Core API</li>
<li>Management API</li>
</ul>
<p>These APIs are involved in authenticating their clients (the FoundationaLLM portals and any other actor calling them).
They are also involved in enforcing and managing the underlying Role-Based Access Control model of the platform.</p>
<h2 id="rationale-behind-the-architectural-decision">Rationale behind the architectural decision</h2>
<p>When authenticating against Graph API, any custom-built API has two choices:</p>
<ul>
<li>Using an Entra ID application registration with a client secret</li>
<li>or using a managed identity</li>
</ul>
<p>In both cases, the underlying service principal (the enterprise application associated with the application registration or the managed identity itself) will need the proper permissions to the Graph API to fulfill its tasks.
<a href="https://learn.microsoft.com/en-us/entra/identity/managed-identities-azure-resources/overview">According to Microsoft's official documentation</a>:
<code>&quot;Managed identities provide an automatically managed identity in Microsoft Entra ID for applications to use when connecting to resources that support Microsoft Entra ID authentication. Applications can use managed identities to obtain Microsoft Entra ID tokens without having to manage any credentials.&quot;</code></p>
<p>The recommended path forward is using managed identities as opposed to any approach that involves using secrets that need to be managed (plain or certificates).</p>
<p>This is the underlying justification for our architectural decision to assign permissions to the managed identities.</p>
<h2 id="justification-of-the-need">Justification of the need</h2>
<p>Any standard Role-Based Access Control capability requires the following core features (none of them being optional):</p>
<ul>
<li>Based on the object ID of a security principal, retrieve the security groups it belongs to (either directly or transitively).</li>
<li>Based on a list of object IDs of security principals, retrieve their display names (to display meaningful information in the RBAC management experience).</li>
<li>Select users, groups, or service principals that are targets for role assignments in the RBAC model.</li>
</ul>
<div class="NOTE">
<h5>Note</h5>
<p>&quot;Entry-level&quot; approach is to ask for group membership in access tokens. This approach has significant limitations as it is limited to a small number of groups which, if exceeded, will result in a Graph API reference added to the access token, forcing the code to call into Graph API. This limit is hit with almost certainty in enterprise scenarios, hance our decision to use the robust approach (directly calling Graph API) by default.</p>
</div>
<p>Based on all of the above, the justification for the requested roles is as follows:</p>
<ul>
<li><code>Group.Read.All</code> - required to get the group membership for security principals authenticated against the APIs which is in turn used to evaluate their role membership and level of access to the capabilities of the platform. Also required to list security groups when FoundationaLLM RBAC roles are assigned to them.</li>
<li><code>User.Read.All</code> - required for group membership retrieval and to list users when FoundationaLLM RBAC roles are assigned to them.</li>
<li><code>Application.Read.All</code> - required for group membership retrieval and to list security principals when FoundationaLLM RBAC roles are assigned to them.</li>
</ul>
<div class="NOTE">
<h5>Note</h5>
<p>From the Graph API documentation (<a href="https://learn.microsoft.com/en-us/graph/permissions-reference">https://learn.microsoft.com/en-us/graph/permissions-reference</a>):
&quot;In some cases, an app might need extra permissions to read some group properties like member and memberOf. For example, if a group has one or more service principals as members, the app also needs permissions to read service principals, otherwise Microsoft Graph returns an error or limited information.&quot;</p>
</div>
<h2 id="transparency-and-auditing">Transparency and auditing</h2>
<p>The FoundationaLLM source code is fully available in a public GitHub repo: <a href="https://github.com/solliancenet/foundationallm">https://github.com/solliancenet/foundationallm</a>.
We took this critical decision precisely for cases like this, where our customers need to understand (and also fully audit if needed) the security implications of the permissions granted to various FoundationaLLM components during deployment.
For the specific case of Graph API interactions, the behavior is fully encapsulated in one <a href="https://github.com/solliancenet/foundationallm/blob/main/src/dotnet/Common/Services/Security/MicrosoftGraphIdentityManagementService.cs">service implementation</a>
It can be immediately verified that:</p>
<ul>
<li>Our code performs only the operations mentioned above.</li>
<li>Our code uses the smallest possible subset of properties to fulfill its required functionality.</li>
</ul>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/foundationallm/foundationallm/blob/main/docs/operations/graph-api-permissions.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © FoundationaLLM. All rights reserved. | Find out more about FoundationaLLM at <a href="https://foundationallm.ai">foundationallm.ai</a>.
        </div>
      </div>
    </footer>
  </body>
</html>
