<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
      <title>History of breaking changes | FoundationaLLM </title>
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <meta name="title" content="History of breaking changes | FoundationaLLM ">
      
      
      <link rel="icon" href="../media/favicon.ico">
      <link rel="stylesheet" href="../public/docfx.min.css">
      <link rel="stylesheet" href="../public/main.css">
      <meta name="docfx:navrel" content="../toc.html">
      <meta name="docfx:tocrel" content="../toc.html">
      
      <meta name="docfx:rel" content="../">
      
      
      <meta name="docfx:docurl" content="https://github.com/solliancenet/foundationallm/blob/main/docs/release-notes/breaking-changes.md/#L1">
      <meta name="loc:inThisArticle" content="In this article">
      <meta name="loc:searchResultsCount" content="{count} results for &quot;{query}&quot;">
      <meta name="loc:searchNoResults" content="No results for &quot;{query}&quot;">
      <meta name="loc:tocFilter" content="Filter by title">
      <meta name="loc:nextArticle" content="Next">
      <meta name="loc:prevArticle" content="Previous">
      <meta name="loc:themeLight" content="Light">
      <meta name="loc:themeDark" content="Dark">
      <meta name="loc:themeAuto" content="Auto">
      <meta name="loc:changeTheme" content="Change theme">
      <meta name="loc:copy" content="Copy">
      <meta name="loc:downloadPdf" content="Download PDF">

      <script type="module" src="./../public/docfx.min.js"></script>

      <script>
        const theme = localStorage.getItem('theme') || 'auto'
        document.documentElement.setAttribute('data-bs-theme', theme === 'auto' ? (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light') : theme)
      </script>

  </head>

  <body class="tex2jax_ignore" data-layout="" data-yaml-mime="">
    <header class="bg-body border-bottom">
      <nav id="autocollapse" class="navbar navbar-expand-md" role="navigation">
        <div class="container-xxl flex-nowrap">
          <a class="navbar-brand" href="../index.html">
            <img id="logo" class="svg" src="../media/fllm-icon.svg" alt="FoundationaLLM">
            FoundationaLLM
          </a>
          <button class="btn btn-lg d-md-none border-0" type="button" data-bs-toggle="collapse" data-bs-target="#navpanel" aria-controls="navpanel" aria-expanded="false" aria-label="Toggle navigation">
            <i class="bi bi-three-dots"></i>
          </button>
          <div class="collapse navbar-collapse" id="navpanel">
            <div id="navbar">
              <form class="search" role="search" id="search">
                <i class="bi bi-search"></i>
                <input class="form-control" id="search-query" type="search" disabled placeholder="Search" autocomplete="off" aria-label="Search">
              </form>
            </div>
          </div>
        </div>
      </nav>
    </header>

    <main class="container-xxl">

      <div class="content">
        <div class="actionbar">

          <nav id="breadcrumb"></nav>
        </div>

        <article data-uid="">
<h1 id="history-of-breaking-changes">History of breaking changes</h1>

<div class="NOTE">
<h5>Note</h5>
<p>This section is for changes that are not yet released but will affect future releases.</p>
</div>
<h2 id="starting-with-091">Starting with 0.9.1</h2>
<h3 id="configuration-changes">Configuration changes</h3>
<p>The following new App Configuration settings are required:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM:Code:CodeExecution:AzureContainerAppsDynamicSessions</code></td>
<td><code>{&quot;DynamicSessionsEndpoints&quot;: []}</code></td>
<td>Provides the configuration for the Azure Container Apps Dynamic Sessions code execution service. <code>DynamicSessionsEnpoints</code> is a list of Dynamic Sessions endpoints that are used to run code execution sessions. Must contain at least one value.</td>
</tr>
</tbody>
</table>
<h3 id="agent-tool-configuration-changes">Agent tool configuration changes</h3>
<p>Each agent tool should have an entry in the <code>properties</code> dictionary named <code>foundationallm_aca_code_execution_enabled</code> (<code>true</code> or <code>false</code>) to indicate whether the tool requires code execution sessions based on the the Azure Container Apps Dynamic Sessions service.</p>
<h3 id="prompt-definition-changes">Prompt definition changes</h3>
<p>Prompt prefixes and suffixes support FoundationaLLM variables for dynamic replacement at runtime. The variable format is <code>{{foundationallm:variable_name[:format]}}</code> where</p>
<ul>
<li><code>variable_name</code> is the name of the well-known variable.</li>
<li><code>format</code> is the optional formatting applied to the value of the variable.</li>
</ul>
<p>The following variables are supported:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
<th>Example</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>current_datetime_utc</code></td>
<td>The current UTC date and time.</td>
<td><code>The current date is {{foundationallm:current_datetime_utc:dddd, MMMM dd, yyyy}}. This looks great.</code> -&gt; <code>The current date is Sunday, December 15, 2024. This looks great.</code></td>
</tr>
</tbody>
</table>
<h2 id="starting-with-090">Starting with 0.9.0</h2>
<h3 id="configuration-changes-1">Configuration changes</h3>
<p>The following new App Configuration settings are required:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM:PythonSDK:Logging:LogLevel:Default</code></td>
<td><code>Information</code></td>
<td><code>-</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:PythonSDK:Logging:EnableConsoleLogging</code></td>
<td><code>false</code></td>
<td><code>-</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:CoreAPI:Configuration:Entra:RequireScopes</code></td>
<td><code>true</code></td>
<td>Indicates whether a scope claim (scp) is required for authorization. Set to <code>false</code> to allow authentication from an external proxy API.</td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:CoreAPI:Configuration:Entra:AllowACLAuthorization</code></td>
<td><code>false</code></td>
<td>Indicates whether tokens that do not have either of the &quot;scp&quot; or &quot;roles&quot; claims are accepted (True means they are accepted). Set to <code>true</code> to allow authentication from an external proxy API.</td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:LangChainAPI:Configuration:ExternalModules:Storage:AccountName</code></td>
<td><code>-</code></td>
<td><code>-</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:LangChainAPI:Configuration:ExternalModules:Storage:AuthenticationType</code></td>
<td><code>-</code></td>
<td><code>-</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:LangChainAPI:Configuration:ExternalModules:RootStorageContainer</code></td>
<td><code>-</code></td>
<td><code>-</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:LangChainAPI:Configuration:ExternalModules:Modules</code></td>
<td><code>-</code></td>
<td><code>-</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:LangChainAPI:Configuration:PollingIntervalSeconds</code></td>
<td><code>10</code></td>
<td>The interval in seconds at which the LangChain API will be polled for status.</td>
</tr>
<tr>
<td><code>FoundationaLLM:UserPortal:Configuration:ShowMessageRating</code></td>
<td><code>true</code></td>
<td>If <code>true</code>, rating options on agent messages will appear.</td>
</tr>
<tr>
<td><code>FoundationaLLM:UserPortal:Configuration:ShowLastConversationOnStartup</code></td>
<td><code>false</code></td>
<td>If <code>true</code>, the last conversation will be displayed when the user logs in. Otherwise, a new conversation placeholder appears on page load.</td>
</tr>
<tr>
<td><code>FoundationaLLM:UserPortal:Configuration:ShowMessageTokens</code></td>
<td><code>true</code></td>
<td>If <code>true</code>, the number of consumed tokens on agent and user messages will appear.</td>
</tr>
<tr>
<td><code>FoundationaLLM:UserPortal:Configuration:ShowViewPrompt</code></td>
<td><code>true</code></td>
<td>If <code>true</code>, the &quot;View Prompt&quot; button on agent messages will appear.</td>
</tr>
<tr>
<td><code>FoundationaLLM:Instance:EnableResourceProvidersCache</code></td>
<td><code>false</code></td>
<td>If <code>true</code>, the caching of resource providers will be enabled.</td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:AuthorizationAPI:Essentials:EnableCache</code></td>
<td><code>false</code></td>
<td>If <code>true</code>, the caching of authorization call results will be enabled.</td>
</tr>
</tbody>
</table>
<h4 id="agent-tool-configuration-changes-1">Agent Tool configuration changes</h4>
<p>Agent tools are now an array of AgentTool objects rather than a dictionary.</p>
<p>When defining tools for an agent, each tool now requires a <code>package_name</code> property. This property is used to identify the package that contains the tool's implementation. If the tool is internal, the <code>package_name</code> should be set to <code>FoundationaLLM</code>, if the tool is external, the <code>package_name</code> should be set to the name of the external package.</p>
<h4 id="security-related-changes">Security-related changes</h4>
<p>The <strong>Authorization API</strong> now requires the ability to write to the Key Vault account contained within the auth resource group. Currently, the Authorization APIs managed identity is assigned to the <code>Key Vault Secrets User</code> role on the Key Vault account. This role assignment must be updated to include the <code>Key Vault Secrets Officer</code> role in addition to the user role.</p>
<h4 id="renamed-classes">Renamed classes</h4>
<p>The following classes have been renamed:</p>
<table>
<thead>
<tr>
<th>Original Class</th>
<th>New Class</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM.Common.Models.Orchestration.Response.Citation</code></td>
<td><code>FoundationaLLM.Common.Models.Orchestration.Response.ContentArtifact</code></td>
</tr>
</tbody>
</table>
<h4 id="api-endpoint-changes">API endpoint changes</h4>
<p><strong>Core API</strong></p>
<p>The <code>/instances/{instanceId}/sessions/{sessionId}/message/{id}/rate</code> endpoint has been updated to accept the rating in the message body, rather than as a query parameter. Send the following payload in the request body:</p>
<pre><code class="lang-json">{
  &quot;rating&quot;: true,
  &quot;comments&quot;: &quot;string&quot;
}
</code></pre>
<div class="NOTE">
<h5>Note</h5>
<p>Please note that both properties are nullable. Set them to null to clear out the rating and comments.</p>
</div>
<h2 id="starting-with-084">Starting with 0.8.4</h2>
<h3 id="configuration-changes-2">Configuration changes</h3>
<p>The following new App Configuration settings are required:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM:APIEndpoints:ManagementAPI:Configuration:AllowedUploadFileExtensions</code></td>
<td><code>c, cpp, cs, css, csv, doc, docx, gif, html, java, jpeg, jpg, js, json, md, pdf, php, png, pptx, py, rb, sh, tar, tex, ts, txt, xlsx, xml, zip</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:Branding:NoAgentsMessage</code></td>
<td><code>No agents available. Please check with your system administrator for assistance.</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:Branding:DefaultAgentWelcomeMessage</code></td>
<td><code>Start the conversation using the text box below.</code></td>
</tr>
</tbody>
</table>
<p>The following new App Configuration feature flags are required:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM.Agent.PrivateStore</code></td>
<td><code>Not enabled</code></td>
</tr>
</tbody>
</table>
<h3 id="assistants-api-enabled-agents">Assistants API enabled Agent(s)</h3>
<div class="IMPORTANT">
<h5>Important</h5>
<p>Any existing agent that has the Assistants API enabled needs to be saved from the Management UI to update itself.</p>
</div>
<h3 id="resource-provider-changes">Resource provider changes</h3>
<p><strong>FoundationaLLM.Authorization</strong></p>
<p>The following entries need to be added to the policy store file:</p>
<pre><code class="lang-json">{
    &quot;name&quot;: &quot;GUID03&quot;,
    &quot;type&quot;: &quot;FoundationaLLM.Authorization/policyAssignments&quot;,
    &quot;object_id&quot;: &quot;/providers/FoundationaLLM.Authorization/policyAssignments/GUID03&quot;,
    &quot;description&quot;: &quot;Ownership on conversation mapping resources managed by the FoundationaLLM.AzureOpenAI resource provider.&quot;,
    &quot;policy_definition_id&quot;: &quot;/providers/FoundationaLLM.Authorization/policyDefinitions/00000000-0000-0000-0001-000000000001&quot;,
    &quot;principal_id&quot;: &quot;SECURITY_GROUP_ID&quot;,
    &quot;principal_type&quot;: &quot;Group&quot;,
    &quot;scope&quot;: &quot;/instances/FOUNDATIONALLM_INSTANCEID/providers/FoundationaLLM.AzureOpenAI/conversationMappings&quot;,
    &quot;created_on&quot;: &quot;DEPLOY_TIME&quot;,
    &quot;updated_on&quot;: &quot;DEPLOY_TIME&quot;,
    &quot;created_by&quot;: &quot;SYSTEM&quot;,
    &quot;updated_by&quot;: &quot;SYSTEM&quot;
},
{
    &quot;name&quot;: &quot;GUID04&quot;,
    &quot;type&quot;: &quot;FoundationaLLM.Authorization/policyAssignments&quot;,
    &quot;object_id&quot;: &quot;/providers/FoundationaLLM.Authorization/policyAssignments/GUID04&quot;,
    &quot;description&quot;: &quot;Ownership on file mapping resources managed by the FoundationaLLM.AzureOpenAI resource provider.&quot;,
    &quot;policy_definition_id&quot;: &quot;/providers/FoundationaLLM.Authorization/policyDefinitions/00000000-0000-0000-0001-000000000001&quot;,
    &quot;principal_id&quot;: &quot;SECURITY_GROUP_ID&quot;,
    &quot;principal_type&quot;: &quot;Group&quot;,
    &quot;scope&quot;: &quot;/instances/FOUNDATIONALLM_INSTANCEID/providers/FoundationaLLM.AzureOpenAI/fileMappings&quot;,
    &quot;created_on&quot;: &quot;DEPLOY_TIME&quot;,
    &quot;updated_on&quot;: &quot;DEPLOY_TIME&quot;,
    &quot;created_by&quot;: &quot;SYSTEM&quot;,
    &quot;updated_by&quot;: &quot;SYSTEM&quot;
}
</code></pre>
<p>The following placehoders need to be replaced with the actual values:</p>
<ul>
<li><code>SECURITY_GROUP_ID</code> - the ID of the security group that needs to be assigned to the policy</li>
<li><code>FOUNDATIONALLM_INSTANCEID</code> - the ID of the FoundationaLLM instance</li>
<li><code>DEPLOY_TIME</code> - the time when the policy was deployed</li>
<li><code>GUID03</code> and <code>GUID04</code> - unique identifiers for the policy assignments</li>
</ul>
<p><strong>FoundationaLLM.AzureOpenAI</strong></p>
<p>The assistant and file user context artifacts are now simplified and stored in a new Cosmos DB container. Here are the configuration parameters for the new Cosmos DB container:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td>Name</td>
<td><code>ExternalResources</code></td>
</tr>
<tr>
<td>Maximum RU/s</td>
<td>1000</td>
</tr>
<tr>
<td>Time to live</td>
<td>Off</td>
</tr>
<tr>
<td>Partition key</td>
<td><code>/partitionKey</code></td>
</tr>
</tbody>
</table>
<p>Part of the upgrade to this version is to migrate the existing assistant and file user context artifacts to the new Cosmos DB container.
Refer to the dedicated upgrade tool for instructions on how to perform this update.</p>
<p>As a result of the migration, the newly created <code>ExternalResources</code> container will contain two types of items: <code>AzureOpenAIConversationMapping</code> and <code>AzureOpenAIFileMapping</code>.</p>
<p>This is an example of an <code>AzureOpenAIConversationMapping</code> item:</p>
<pre><code class="lang-json">{
    &quot;conversationId&quot;: &quot;0e56a170-5355-...&quot;,
    &quot;openAIAssistantsAssistantId&quot;: &quot;asst_kc...&quot;,
    &quot;openAIAssistantsThreadId&quot;: &quot;thread_73...&quot;,
    &quot;openAIAssistantsThreadCreatedOn&quot;: &quot;2024-10-14T17:57:10.510345+00:00&quot;,
    &quot;openAIVectorStoreId&quot;: &quot;vs_X6...&quot;,
    &quot;openAIVectorStoreCreatedOn&quot;: null,
    &quot;type&quot;: &quot;AzureOpenAIConversationMapping&quot;,
    &quot;id&quot;: &quot;0e56a170-5355-...&quot;,
    &quot;partitionKey&quot;: &quot;...-73fad442-f614-4510-811f-414cb3a3d34b&quot;,
    &quot;upn&quot;: &quot;jackthecat@foundationaLLM.ai&quot;,
    &quot;instanceId&quot;: &quot;73fad442-f614-4510-811f-414cb3a3d34b&quot;,
    &quot;openAIEndpoint&quot;: &quot;https://openai-....openai.azure.com/&quot;,
    &quot;objectId&quot;: null,
    &quot;displayName&quot;: null,
    &quot;description&quot;: null,
    &quot;costCenter&quot;: null,
    &quot;properties&quot;: null,
    &quot;createdOn&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;updatedOn&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;createdBy&quot;: null,
    &quot;updatedBy&quot;: null,
    &quot;deleted&quot;: false,
    &quot;expirationDate&quot;: null,
    &quot;name&quot;: &quot;0e56a170-5355-...&quot;,
    &quot;_rid&quot;: &quot;J2BUAKktW41bAAAAAAAAAA==&quot;,
    &quot;_self&quot;: &quot;dbs/J2BUAA==/colls/J2BUAKktW40=/docs/J2BUAKktW41bAAAAAAAAAA==/&quot;,
    &quot;_etag&quot;: &quot;\&quot;8702b793-0000-0200-0000-672a60b90000\&quot;&quot;,
    &quot;_attachments&quot;: &quot;attachments/&quot;,
    &quot;_ts&quot;: 1730830521
}
</code></pre>
<p>This is an example of an <code>AzureOpenAIFileMapping</code> item:</p>
<pre><code class="lang-json">{
    &quot;fileObjectId&quot;: &quot;/instances/73fad442-f614-4510-811f-414cb3a3d34b/providers/FoundationaLLM.Attachment/attachments/a-f8...&quot;,
    &quot;originalFileName&quot;: &quot;some_file.csv&quot;,
    &quot;fileContentType&quot;: &quot;text/csv&quot;,
    &quot;fileRequiresVectorization&quot;: false,
    &quot;openAIFileId&quot;: &quot;assistant-8G...&quot;,
    &quot;openAIFileUploadedOn&quot;: &quot;2024-10-14T23:01:02.3075592+00:00&quot;,
    &quot;openAIAssistantsFileGeneratedOn&quot;: null,
    &quot;openAIVectorStoreId&quot;: null,
    &quot;type&quot;: &quot;AzureOpenAIFileMapping&quot;,
    &quot;id&quot;: &quot;assistant-8G...&quot;,
    &quot;partitionKey&quot;: &quot;...-73fad442-f614-4510-811f-414cb3a3d34b&quot;,
    &quot;upn&quot;: &quot;jackthecat@foundationaLLM.ai&quot;,
    &quot;instanceId&quot;: &quot;73fad442-f614-4510-811f-414cb3a3d34b&quot;,
    &quot;openAIEndpoint&quot;: &quot;https://openai-....openai.azure.com/&quot;,
    &quot;objectId&quot;: null,
    &quot;displayName&quot;: null,
    &quot;description&quot;: null,
    &quot;costCenter&quot;: null,
    &quot;properties&quot;: null,
    &quot;createdOn&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;updatedOn&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;createdBy&quot;: null,
    &quot;updatedBy&quot;: null,
    &quot;deleted&quot;: false,
    &quot;expirationDate&quot;: null,
    &quot;name&quot;: &quot;assistant-8G...&quot;,
    &quot;_rid&quot;: &quot;J2BUAKktW40yAAAAAAAAAA==&quot;,
    &quot;_self&quot;: &quot;dbs/J2BUAA==/colls/J2BUAKktW40=/docs/J2BUAKktW40yAAAAAAAAAA==/&quot;,
    &quot;_etag&quot;: &quot;\&quot;87025e93-0000-0200-0000-672a60b70000\&quot;&quot;,
    &quot;_attachments&quot;: &quot;attachments/&quot;,
    &quot;_ts&quot;: 1730830519
}
</code></pre>
<h3 id="cleanup-role-assignments">Cleanup role assignments</h3>
<p>As a result of migrated resources from storage account to Cosmos DB, as well as the new <code>policy-assignments</code> mentioned above, the <code>role-assignments</code> store will have obsolete <code>Owner</code> role assignments on those objects. Please refer to the dedicated tool for instructions on how to perform this cleanup.</p>
<p>The dedicated tool will cleanup role assignments for the following resources:</p>
<ul>
<li><code>FoundationaLLM.Attachment/attachments</code></li>
<li><code>FoundationaLLM.AzureOpenAI/fileUserContexts</code></li>
<li><code>FoundationaLLM.AzureOpenAI/assistantUserContexts</code></li>
<li><code>FoundationaLLM.Conversation/conversations</code></li>
</ul>
<h3 id="configuration-changes-3">Configuration changes</h3>
<h4 id="resource-provider-templates">Resource provider templates</h4>
<p>The <code>AzureOpenAI.template.json</code> files within <code>deploy/quick-start/data/resource-provider/FoundationaLLM.Configuration</code> and <code>deploy/standard/data/resource-provider/FoundationaLLM.Configuration</code> have been updated to set the <code>category</code> field to the value <code>LLM</code>. This discriminator allows the Management Portal to filter the list of API endpoints by category and provide options to add AI Models to endpoints with the <code>LLM</code> category.</p>
<p>The existing <code>category</code> property needs to be set to <code>LLM</code> on existing API endpoint configurations in the <code>FoundationaLLM.Configuration</code> resource provider that fit this description, including the <code>AzureOpenAI</code> endpoint configuration.</p>
<h2 id="starting-with-083">Starting with 0.8.3</h2>
<h3 id="resource-provider-changes-1">Resource provider changes</h3>
<p>If a user/group is not assigned to the instance-level Contributor role, then they will not be able to create new Conversations or upload Attachments. To adjust their permissions, the following changes are required:</p>
<p><strong>FoundationaLLM.Conversation</strong></p>
<p>In addition to assigning users/groups to the <code>policy-assignments/&lt;instance_id&gt;-policy.json</code> file within the <code>FoundationaLLM.Authorization</code> resource provider to assign them to the Conversation policy, we must now add them to the new <strong>Conversation contributor role</strong> (<code>role_definition_id</code>: <code>d0d21b90-5317-499a-9208-3a6cb71b84f9</code>) within the <code>role-assignments/&lt;instance_id&gt;-role.json</code> file within the <code>FoundationaLLM.Authorization</code> resource provider if the user/group is not assigned to the Contributor role on the FoundationaLLM instance (<code>role_definition_id</code>: <code>a9f0020f-6e3a-49bf-8d1d-35fd53058edf</code>). Here is an example entry:</p>
<pre><code class="lang-json">{
    &quot;type&quot;: &quot;FoundationaLLM.Authorization/roleAssignments&quot;,
    &quot;name&quot;: &quot;a40b15f1-75ce-4a40-a857-1093ac9adf4d&quot;,
    &quot;object_id&quot;: &quot;/instances/0a1840df-71b6-496d-905a-145d93d827f3/providers/FoundationaLLM.Authorization/roleAssignments/a40b15f1-75ce-4a40-a857-1093ac9adf4d&quot;,
    &quot;display_name&quot;: null,
    &quot;description&quot;: &quot;Conversation contributor role for FLLM Users&quot;,
    &quot;cost_center&quot;: null,
    &quot;role_definition_id&quot;: &quot;/providers/FoundationaLLM.Authorization/roleDefinitions/d0d21b90-5317-499a-9208-3a6cb71b84f9&quot;,
    &quot;principal_id&quot;: &quot;aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee&quot;,
    &quot;principal_type&quot;: &quot;Group&quot;,
    &quot;scope&quot;: &quot;/instances/0a1840df-71b6-496d-905a-145d93d827f3&quot;,
    &quot;properties&quot;: null,
    &quot;created_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;updated_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;created_by&quot;: null,
    &quot;updated_by&quot;: null,
    &quot;deleted&quot;: false,
    &quot;expiration_date&quot;: null
}
</code></pre>
<p><strong>FoundationaLLM.Attachment</strong></p>
<p>In addition to assigning users/groups to the <code>policy-assignments/&lt;instance_id&gt;-policy.json</code> file within the <code>FoundationaLLM.Authorization</code> resource provider to assign them to the Attachment policy, we must now add them to the new <strong>Attachment contributor role</strong> (<code>role_definition_id</code>: <code>8e77fb6a-7a78-43e1-b628-d9e2285fe25a</code>) within the <code>role-assignments/&lt;instance_id&gt;-role.json</code> file within the <code>FoundationaLLM.Authorization</code> resource provider if the user/group is not assigned to the Contributor role on the FoundationaLLM instance (<code>role_definition_id</code>: <code>a9f0020f-6e3a-49bf-8d1d-35fd53058edf</code>). Here is an example entry:</p>
<pre><code class="lang-json">{
    &quot;type&quot;: &quot;FoundationaLLM.Authorization/roleAssignments&quot;,
    &quot;name&quot;: &quot;891ca947-e648-46cf-a12a-774b52ded886&quot;,
    &quot;object_id&quot;: &quot;/instances/0a1840df-71b6-496d-905a-145d93d827f3/providers/FoundationaLLM.Authorization/roleAssignments/891ca947-e648-46cf-a12a-774b52ded886&quot;,
    &quot;display_name&quot;: null,
    &quot;description&quot;: &quot;Attachment contributor role for FLLM Users&quot;,
    &quot;cost_center&quot;: null,
    &quot;role_definition_id&quot;: &quot;/providers/FoundationaLLM.Authorization/roleDefinitions/8e77fb6a-7a78-43e1-b628-d9e2285fe25a&quot;,
    &quot;principal_id&quot;: &quot;aaaaaaaa-bbbb-cccc-dddd-eeeeeeeeeeee&quot;,
    &quot;principal_type&quot;: &quot;Group&quot;,
    &quot;scope&quot;: &quot;/instances/0a1840df-71b6-496d-905a-145d93d827f3&quot;,
    &quot;properties&quot;: null,
    &quot;created_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;updated_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;created_by&quot;: null,
    &quot;updated_by&quot;: null,
    &quot;deleted&quot;: false,
    &quot;expiration_date&quot;: null
}
</code></pre>
<h2 id="starting-with-082">Starting with 0.8.2</h2>
<h3 id="configuration-changes-4">Configuration changes</h3>
<p>The following settings are required:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM:APIEndpoints:CoreAPI:Configuration:AllowedUploadFileExtensions</code></td>
<td><code>c, cpp, cs, css, csv, doc, docx, gif, html, java, jpeg, jpg, js, json, md, pdf, php, png, pptx, py, rb, sh, tar, tex, ts, txt, xlsx, xml, zip</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:CoreAPI:Configuration:AzureOpenAIAssistantsFileSearchFileExtensions</code></td>
<td><code>c, cpp, cs, css, doc, docx, html, java, js, json, md, pdf, php, pptx, py, rb, sh, tex, ts, txt</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:CoreAPI:Configuration:MaxUploadsPerMessage</code></td>
<td><code>{ &quot;value&quot;: 10, &quot;value_exceptions&quot;: [] }</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:CoreAPI:Configuration:CompletionResponsePollingIntervalSeconds</code></td>
<td><code>{ &quot;value&quot;: 5, &quot;value_exceptions&quot;: [] }</code></td>
</tr>
<tr>
<td><code>FoundationaLLM:APIEndpoints:GatewayAPI:Configuration:AzureOpenAIAssistantsMaxVectorizationTimeSeconds</code></td>
<td><code>120</code></td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>Here is an example of an override for the <code>MaxUploadsPerMessage</code> setting:</p>
<pre><code class="lang-json">{
  &quot;value&quot;: 10,
  &quot;value_exceptions&quot;: [
      {
          &quot;user_principal_name&quot;: &quot;ciprian@solliance.net&quot;,
          &quot;value&quot;: 5,
          &quot;enabled&quot;: true
      }
  ]
}
</code></pre>
</div>
<div class="NOTE">
<h5>Note</h5>
<p>Here is an example of an override for the <code>CompletionResponsePollingIntervalSeconds</code> setting:</p>
<pre><code class="lang-json">{
  &quot;value&quot;: 5,
  &quot;value_exceptions&quot;: [
      {
          &quot;user_principal_name&quot;: &quot;ciprian@solliance.net&quot;,
          &quot;value&quot;: 3,
          &quot;enabled&quot;: true
      }
  ]
}

</code></pre>
</div>
<p>The following settings are optional (they should not be set by default):</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Default value</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>FoundationaLLM:Instance:IdentitySubstitutionSecurityPrincipalId</code></td>
<td>&lt;security_principal_id&gt;</td>
</tr>
<tr>
<td><code>FoundationaLLM:Instance:IdentitySubstitutionUserPrincipalNamePattern</code></td>
<td><code>^fllm_load_test_user_\d{5}_\d{3}@solliance\.net$</code></td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>The <code>FoundationaLLM:Instance:IdentitySubstitutionSecurityPrincipalId</code> and <code>FoundationaLLM:Instance:IdentitySubstitutionUserPrincipalNamePattern</code> settings are used for load testing purposes only. If set, their values must be replaced with the appropriate values for the specific Entra ID tenant.</p>
</div>
<h3 id="resource-provider-changes-2">Resource provider changes</h3>
<p>The following resource provider files must be renamed (if they already exist):</p>
<table>
<thead>
<tr>
<th>Location</th>
<th>Old name</th>
<th>New name</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>resource-provider/FoundationaLLM.Agent</code></td>
<td><code>_agent-references.json</code></td>
<td><code>_resource-references.json</code></td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.AIModel</code></td>
<td><code>_ai-model-references.json</code></td>
<td><code>_resource-references.json</code></td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.Configuration</code></td>
<td><code>_api-endpoint-references.json</code></td>
<td><code>_resource-references.json</code></td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.DataSource</code></td>
<td><code>_data-source-references.json</code></td>
<td><code>_resource-references.json</code></td>
</tr>
<tr>
<td><code>resource-provider/FoundationaLLM.Prompt</code></td>
<td><code>_prompt-references.json</code></td>
<td><code>_resource-references.json</code></td>
</tr>
</tbody>
</table>
<div class="NOTE">
<h5>Note</h5>
<p>Within each of the renamed files, the <code>&lt;entity&gt;References</code> property must be renamed to <code>ResourceReferences</code>.</p>
</div>
<p><strong>FoundationaLLM.Agent</strong></p>
<p>A new property can be added to agent definitions:</p>
<pre><code class="lang-json">&quot;tools&quot;: {
    &quot;dalle-image-generation&quot;: {
        &quot;name&quot;: &quot;dalle-image-generation&quot;,
        &quot;description&quot;: &quot;Generates an image based on a prompt.&quot;,
        &quot;ai_model_object_ids&quot;: {
            &quot;main_model&quot;: &quot;/instances/73fad442-f614-4510-811f-414cb3a3d34b/providers/FoundationaLLM.AIModel/aiModels/DALLE3&quot;
        }
    }
}
</code></pre>
<p><strong>FoundationaLLM.Authorization</strong></p>
<p>A new storage container named <code>policy-assignments</code> is required. The <code>FoundationaLLM.Authorization</code> resource provider will use this container to store policy assignments.</p>
<p>Within the container, the <code>&lt;instance_id&gt;-policy.json</code> must be deployed with the default policy assignments. The template for the default policy assignments is available in <code>Common/Constants/Data/DefaultPolicyAssignments.json</code>.</p>
<p><strong>FoundationaLLM.Conversation</strong></p>
<p>When upgrading an existing FoundationaLLM instance, the items in the <code>Sessions</code> collection in Cosmos DB must be updated according to the following rules:</p>
<pre><code>if Object is of type Session of KioskSession:
    If the property DisplayName exists and is set to a non-empty string:
        Don't touch the item
    else:
        Set DisplayName to the value of Name
        Set Name to the value of SessionId
else:
    No action needed
</code></pre>
<p>Refer to the dedicated upgrade tool for instruction on how to perform this update.</p>
<p><strong>FoundationaLLM.Configuration</strong></p>
<p>The OneDrive (Work or School) integration requires the following API Endpoint Configuration entry in the storage account:</p>
<p><code>FoundationaLLM.Configuration/OneDriveFileStoreConnector.json</code></p>
<pre><code class="lang-json">{
    &quot;type&quot;: &quot;api-endpoint&quot;,
    &quot;name&quot;: &quot;OneDriveFileStoreConnector&quot;,
    &quot;object_id&quot;: &quot;/instances/{{instance_id}}/providers/FoundationaLLM.Configuration/apiEndpointConfigurations/OneDriveFileStoreConnector&quot;,
    &quot;display_name&quot;: null,
    &quot;description&quot;: null,
    &quot;cost_center&quot;: null,
    &quot;category&quot;: &quot;FileStoreConnector&quot;,
    &quot;subcategory&quot;: &quot;OneDriveWorkSchool&quot;,
    &quot;authentication_type&quot;: &quot;AzureIdentity&quot;,
    &quot;authentication_parameters&quot;: {
      &quot;scope&quot;: &quot;Files.Read.All&quot;
    },
    &quot;url&quot;: &quot;{{onedrive_base_url}}&quot;,
    &quot;status_url&quot;: &quot;&quot;,
    &quot;url_exceptions&quot;: [],
    &quot;timeout_seconds&quot;: 2400,
    &quot;retry_strategy_name&quot;: &quot;ExponentialBackoff&quot;,
    &quot;created_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;updated_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;created_by&quot;: null,
    &quot;updated_by&quot;: &quot;SYSTEM&quot;,
    &quot;deleted&quot;: false
  }
</code></pre>
<p>Update <code>FoundationaLLM.Configuration/_resource-references_.json</code> with the reference to the file above.</p>
<pre><code class="lang-json">{
	&quot;Name&quot;: &quot;OneDriveFileStoreConnector&quot;,
	&quot;Filename&quot;: &quot;/FoundationaLLM.Configuration/OneDriveFileStoreConnector.json&quot;,
	&quot;Type&quot;: &quot;api-endpoint&quot;,
	&quot;Deleted&quot;: false
}
</code></pre>
<p><strong>FoundationaLLM.Attachment</strong></p>
<p>The Attachment resource provider now saves the attachment references to Cosmos DB, instead of Data Lake storage.
A new Cosmos DB container must be created, named <code>Attachments</code>, with the following partition key: <code>/upn</code>.</p>
<p>The following MSIs require a Cosmos DB role assigned:</p>
<ol>
<li>Gateway API</li>
<li>Orchestration API</li>
<li>Management API</li>
</ol>
<h3 id="long-running-operations">Long-Running Operations</h3>
<p>The context for a long-running operation is now stored in Cosmos DB.
A new Cosmos DB container must be created, named <code>Operations</code>, with a partition key <code>/id</code>.</p>
<h2 id="starting-with-080">Starting with 0.8.0</h2>
<p>Core API changes:</p>
<ol>
<li>All Core API endpoints have been moved to the <code>/instances/{instanceId}</code> path. For example, the <code>/status</code> endpoint is now <code>/instances/{instanceId}/status</code>.</li>
<li>The <code>/orchestration/*</code> endpoints have been moved to <code>/instances/{instanceId}/completions/*</code>.
<ol>
<li>The previous <code>/orchestration/completions</code> endpoint is now <code>/instances/{instanceId}/completions</code>.</li>
</ol>
</li>
<li>The <code>/sessions/{sessionId}/completion</code> endpoint has been moved to <code>/instances/{instanceId}/completions</code>. Instead of having the <code>sessionId</code> as a path parameter, it is now in the request body as part of the <code>CompletionRequest</code> payload.</li>
<li><code>/sessions/{sessionId}/summarize-name</code> has been removed. In the future, the <code>/completions</code> endpoint will be used to generate summaries.</li>
<li><code>OrchestrationRequest</code> and <code>CompletionRequest</code> have combined into a single <code>CompletionRequest</code> object.</li>
<li><code>DirectionCompletionRequest</code> has been removed. Use <code>CompletionRequest</code> instead.</li>
<li><code>Status</code> controllers <code>\status</code> action in the .NET API projects return value has renamed the <code>Instance</code> property to <code>InstanceName</code>.</li>
<li>The <code>CompletionController.cs</code> file under <code>dotnet/CoreApi/controllers</code> has introduced the <code>Async-Completions</code> endpoint to handle asynchronous completions.</li>
<li>With the introduction of <code>Async-Completions</code>, long running operations can now report on completion status based on <code>Pending</code>, <code>InProgress</code>, <code>Completed</code> and <code>Failed</code> states.</li>
<li>Vectorization Embedding Profile introduces a required key in the <code>Settings</code> property named <code>model_name</code>. Every embedding request now flows through the Gateway API.</li>
<li>Vectorization Indexing Profile introduces a required key <code>api_endpoint_configuration_object_id</code> in the <code>Settings</code> property.</li>
<li>Retirement of <code>SemanticKernel</code> embedding type. All embedding requests now flow through the Gateway API.</li>
</ol>
<p>Gatekeeper API changes:</p>
<ol>
<li>All Gatekeeper API endpoints have been moved to the <code>/instances/{instanceId}</code> path. For example, the <code>/status</code> endpoint is now <code>/instances/{instanceId}/status</code>.</li>
<li>The <code>/orchestration/*</code> endpoints have been moved to <code>/instances/{instanceId}/completions/*</code>.</li>
</ol>
<p>Orchestration API changes:</p>
<ol>
<li>All Gatekeeper API endpoints have been moved to the <code>/instances/{instanceId}</code> path. For example, the <code>/status</code> endpoint is now <code>/instances/{instanceId}/status</code>.</li>
<li>The <code>/orchestration/*</code> endpoints have been moved to <code>/instances/{instanceId}/completions/*</code>.
=======</li>
</ol>
<h3 id="new-apis">New APIs</h3>
<p><strong>Gateway Adapter API</strong> - requires the following configuration settings:</p>
<ul>
<li><code>FoundationaLLM:APIs:GatewayAdapterAPI:APIUrl</code></li>
<li><code>FoundationaLLM:APIs:GatewayAdapterAPI:APIKey</code> (mapped to the <code>foundationallm-apis-gatewayadapterapi-apikey</code> secret)</li>
<li><code>FoundationaLLM:APIs:GatewayAdapterAPI:APIAppInsightsConnectionString</code> (mapped to the <code>foundationallm-app-insights-connection-string</code> secret)</li>
<li></li>
</ul>
<p><strong>State API</strong> - requires the following configuration settings:</p>
<ul>
<li><code>FoundationaLLM:APIs:StateAPI:APIUrl</code></li>
<li><code>FoundationaLLM:APIs:StateAPI:APIKey</code> (mapped to the <code>foundationallm-apis-stateapi-apikey</code> secret)</li>
<li><code>FoundationaLLM:APIs:StateAPI:APIAppInsightsConnectionString</code> (mapped to the <code>foundationallm-app-insights-connection-string</code> secret)</li>
</ul>
<div class="NOTE">
<h5>Note</h5>
<p>These new APIs will be converted to use the new <code>APIEndpoint</code> artifacts.</p>
</div>
<h3 id="changes-in-app-registration-names">Changes in app registration names</h3>
<table>
<thead>
<tr>
<th>API Name</th>
<th>Entra ID app registration name</th>
<th>Application ID URI</th>
<th>Scope name</th>
</tr>
</thead>
<tbody>
<tr>
<td>Core API</td>
<td><code>FoundationaLLM-Core-API</code></td>
<td><code>api://FoundationaLLM-Core</code></td>
<td><code>Data.Read</code></td>
</tr>
<tr>
<td>Management API</td>
<td><code>FoundationaLLM-Management-API</code></td>
<td><code>api://FoundationaLLM-Management</code></td>
<td><code>Data.Manage</code></td>
</tr>
<tr>
<td>Authorization API</td>
<td><code>FoundationaLLM-Authorization-API</code></td>
<td><code>api://FoundationaLLM-Authorization</code></td>
<td><code>Authorization.Manage</code></td>
</tr>
<tr>
<td>User Portal</td>
<td><code>FoundationaLLM-Core-Portal</code></td>
<td><code>api://FoundationaLLM-Core-Portal</code></td>
<td>N/A</td>
</tr>
<tr>
<td>Management Portal</td>
<td><code>FoundationaLLM-Management-Portal</code></td>
<td><code>api://FoundationaLLM-Management-Portal</code></td>
<td>N/A</td>
</tr>
</tbody>
</table>
<h3 id="changes-in-app-configuration-settings">Changes in app configuration settings</h3>
<p>The <code>FoundationaLLM:APIs</code> and <code>FoundationaLLM:ExternalAPIs</code> configuration namespaces have been replaced with the <code>FoundationaLLM:APIEndpoints</code> configuration namespace.</p>
<div class="IMPORTANT">
<h5>Important</h5>
<p>All existing API registrations need to be updated to reflect these changes. The only two settings that will exist under <code>FoundationaLLM:APIEndpoints</code> are <code>APIKey</code> (for those API enpoints which use API key authentication) and <code>AppInsightsConnectionString</code>, all the other settings are now part of the <code>APIEndpoint</code> artifact managed by the <code>FoundationaLLM.Configuration</code> resource provider.
This is an example for <code>CoreAPI</code>:</p>
<ul>
<li><code>FoundationaLLM:APIEndpoints:CoreAPI:APIKey</code></li>
<li><code>FoundationaLLM:APIEndpoints:CoreAPI:AppInsightsConnectionString</code></li>
</ul>
</div>
<p>The <code>FoundationaLLM:AzureAIStudio</code> configuration namespace expects an <code>APIEndpointConfigurationName</code> property instead of <code>BaseUrl</code>.</p>
<p>A new configuration setting named <code>FoundationaLLM:Instance:SecurityGroupRetrievalStrategy</code> with a value of <code>IdentityManagementService</code> must exist in the app configuration. It will be added by default in new deployments.</p>
<p>Two new configuration settings required by the new <code>FoundationaLLM.AzureOpenAI</code> resource provider:</p>
<ul>
<li><code>FoundationaLLM:ResourceProviders:AzureOpenAI:Storage:AuthenticationType</code></li>
<li><code>FoundationaLLM:ResourceProviders:AzureOpenAI:Storage:AccountName</code></li>
</ul>
<h2 id="pre-080">Pre-0.8.0</h2>
<ol>
<li><p>Vectorization resource stores use a unique collection name, <code>Resources</code>. They also add a new top-level property named <code>DefaultResourceName</code>.</p>
</li>
<li><p>The items in the <code>index_references</code> collection have a property incorrectly named <code>type</code> which was renamed to <code>index_entry_id</code>.</p>
</li>
<li><p>New gateway API, requires the following app configurations:</p>
<ul>
<li><code>FoundationaLLM:APIs:GatewayAPI:APIUrl</code></li>
<li><code>FoundationaLLM:APIs:GatewayAPI:APIKey</code> (with secret <code>foundationallm-apis-gatewayapi-apikey</code>)</li>
<li><code>FoundationaLLM:APIs:GatewayAPI:AppInsightsConnectionString</code> (with secret <code>foundationallm-app-insights-connection-string</code>)</li>
<li><code>FoundationaLLM:Gateway:AzureOpenAIAccounts</code></li>
</ul>
</li>
<li><p>The <code>AgentFactory</code> and <code>AgentFactoryAPI</code> classes have been renamed to <code>Orchestration</code> and <code>OrchestrationAPI</code>, respectively. The following App Config settings need to be replaced in existing environments:</p>
<ul>
<li><code>FoundationaLLM:APIs:AgentFactoryAPI:APIKey</code> -&gt; <code>FoundationaLLM:APIs:OrchestrationAPI:APIKey</code></li>
<li><code>FoundationaLLM:APIs:AgentFactoryAPI:APIUrl</code> -&gt; <code>FoundationaLLM:APIs:OrchestrationAPI:APIUrl</code></li>
<li><code>FoundationaLLM:APIs:AgentFactoryAPI:AppInsightsConnectionString</code> -&gt; <code>FoundationaLLM:APIs:OrchestrationAPI:AppInsightsConnectionString</code></li>
<li><code>FoundationaLLM:Events:AzureEventGridEventService:Profiles:AgentFactoryAPI</code> -&gt; <code>FoundationaLLM:Events:AzureEventGridEventService:Profiles:OrchestrationAPI</code></li>
<li><code>FoundationaLLM:APIs:AgentFactoryAPI:ForceHttpsRedirection</code> -? <code>FoundationaLLM:APIs:OrchestrationAPI:ForceHttpsRedirection</code></li>
</ul>
</li>
<li><p>The following Key Vault secrets need to be replaced in existing environments:</p>
<ul>
<li><code>foundationallm-apis-agentfactoryapi-apikey</code> -&gt; <code>foundationallm-apis-orchestrationapi-apikey</code></li>
</ul>
<p>There is an upgrade script available that migrates these settings and secrets to their new names.</p>
</li>
<li><p>The following App Config settings are no longer needed:</p>
<ul>
<li><code>FoundationaLLM:Vectorization:Queues:Embed:ConnectionString</code></li>
<li><code>FoundationaLLM:Vectorization:Queues:Extract:ConnectionString</code></li>
<li><code>FoundationaLLM:Vectorization:Queues:Index:ConnectionString</code></li>
<li><code>FoundationaLLM:Vectorization:Queues:Partition:ConnectionString</code></li>
</ul>
</li>
<li><p>The following Key Vault secret is no longer needed:</p>
<ul>
<li><code>foundationallm-vectorization-queues-connectionstring</code></li>
</ul>
</li>
<li><p>The following App Config settings need to be added as key-values:</p>
<ul>
<li><code>FoundationaLLM:Vectorization:Queues:Embed:AccountName</code> (set to the name of the storage account that contains the vectorization queues - e.g., <code>stejahszxcubrpi</code>)</li>
<li><code>FoundationaLLM:Vectorization:Queues:Extract:AccountName</code> (set to the name of the storage account that contains the vectorization queues - e.g., <code>stejahszxcubrpi</code>)</li>
<li><code>FoundationaLLM:Vectorization:Queues:Index:AccountName</code> (set to the name of the storage account that contains the vectorization queues - e.g., <code>stejahszxcubrpi</code>)</li>
<li><code>FoundationaLLM:Vectorization:Queues:Partition:AccountName</code> (set to the name of the storage account that contains the vectorization queues - e.g., <code>stejahszxcubrpi</code>)</li>
</ul>
</li>
<li><p>The value for the App Config setting <code>FoundationaLLM:Events:AzureEventGridEventService:Profiles:OrchestrationAPI</code> should be set in the following format:</p>
<pre><code class="lang-json">{
    &quot;EventProcessingCycleSeconds&quot;: 20,
    &quot;Topics&quot;: [
        {
            &quot;Name&quot;: &quot;storage&quot;,
            &quot;SubscriptionPrefix&quot;: &quot;orch&quot;,
            &quot;EventTypeProfiles&quot;: [
                {
                    &quot;EventType&quot;: &quot;Microsoft.Storage.BlobCreated&quot;,
                    &quot;EventSets&quot;: [
                        {
                            &quot;Namespace&quot;: &quot;ResourceProvider.FoundationaLLM.Agent&quot;,
                            &quot;Source&quot;: &quot;/subscriptions/0a03d4f9-c6e4-4ee1-87fb-e2005d2c213d/resourceGroups/rg-fllm-aca-050/providers/Microsoft.Storage/storageAccounts/stejahszxcubrpi&quot;,
                            &quot;SubjectPrefix&quot;: &quot;/blobServices/default/containers/resource-provider/blobs/FoundationaLLM.Agent&quot;
                        },
                        {
                            &quot;Namespace&quot;: &quot;ResourceProvider.FoundationaLLM.Vectorization&quot;,
                            &quot;Source&quot;: &quot;/subscriptions/0a03d4f9-c6e4-4ee1-87fb-e2005d2c213d/resourceGroups/rg-fllm-aca-050/providers/Microsoft.Storage/storageAccounts/stejahszxcubrpi&quot;,
                            &quot;SubjectPrefix&quot;: &quot;/blobServices/default/containers/resource-provider/blobs/FoundationaLLM.Vectorization&quot;
                        },
                        {
                            &quot;Namespace&quot;: &quot;ResourceProvider.FoundationaLLM.Prompt&quot;,
                            &quot;Source&quot;: &quot;/subscriptions/0a03d4f9-c6e4-4ee1-87fb-e2005d2c213d/resourceGroups/rg-fllm-aca-050/providers/Microsoft.Storage/storageAccounts/stejahszxcubrpi&quot;,
                            &quot;SubjectPrefix&quot;: &quot;/blobServices/default/containers/resource-provider/blobs/FoundationaLLM.Prompt&quot;
                        }
                    ]
                }
            ]
        }
    ]
}
</code></pre>
</li>
<li><p>Vectorization text embedding profiles require only two items in the <code>configuration_references</code> section: <code>DeploymentName</code> and <code>Endpoint</code>. Optionally, a <code>deployment_name</code> entry can be specified in the <code>settings</code> section to override the default value in <code>configuration_references.Endpoint</code>. Here is an example of the updated format for a text embedding profile:</p>
<pre><code class="lang-json">{
    &quot;type&quot;: &quot;text-embedding-profile&quot;,
    &quot;name&quot;: &quot;AzureOpenAI_Embedding_BaselineGlobalMacro&quot;,
    &quot;object_id&quot;: &quot;/instances/a6221c30-0bf2-4003-adb8-d3086bb2ad49/providers/FoundationaLLM.Vectorization/textEmbeddingProfiles/AzureOpenAI_Embedding_BaselineGlobalMacro&quot;,
    &quot;display_name&quot;: null,
    &quot;description&quot;: null,
    &quot;text_embedding&quot;: &quot;SemanticKernelTextEmbedding&quot;,
    &quot;settings&quot;: {
        &quot;deployment_name&quot;: &quot;embeddings-3-large&quot;
    },
    &quot;configuration_references&quot;: {
        &quot;DeploymentName&quot;: &quot;FoundationaLLM:Vectorization:SemanticKernelTextEmbeddingService:DeploymentName&quot;,
        &quot;Endpoint&quot;: &quot;FoundationaLLM:Vectorization:SemanticKernelTextEmbeddingService:Endpoint&quot;
    },
    &quot;created_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;updated_on&quot;: &quot;0001-01-01T00:00:00+00:00&quot;,
    &quot;created_by&quot;: null,
    &quot;updated_by&quot;: null,
    &quot;deleted&quot;: false
}
</code></pre>
</li>
<li><p>External orchestration APIs must be configured using the <code>FoundationaLLM:ExternalAPIs</code> configuration namespace. For example, the <code>BaselineTradingGlobalMacro</code> external API has the following configurations:</p>
<ul>
<li><code>FoundationaLLM:ExternalAPIs:BaselineTradingGlobalMacro:APIUrl</code></li>
<li><code>FoundationaLLM:ExternalAPIs:BaselineTradingGlobalMacro:APIKey</code></li>
</ul>
</li>
</ol>
<div class="NOTE">
<h5>Note</h5>
<p>These entries do not need to be created as part of the deployment process.</p>
</div>
<ol start="12">
<li><p>App Config key namespace that was previously <code>FoundationaLLM:Vectorization:ContentSources:*</code> has been moved to <code>FoundationaLLM:DataSources:*</code>. All existing keys need to be moved to the new namespace.</p>
</li>
<li><p>New app config entries required:</p>
<ul>
<li><code>FoundationaLLM:Attachment:ResourceProviderService:Storage:AuthenticationType</code></li>
<li><code>FoundationaLLM:Attachment:ResourceProviderService:Storage:AccountName</code></li>
</ul>
</li>
<li><p>App Config key namespace that was previously <code>FoundationaLLM:Vectorization:ContentSources:*</code> has been moved to <code>FoundationaLLM:DataSources:*</code>. All existing keys need to be moved to the new namespace.</p>
</li>
<li><p>The following App Config setting needs to be added/updated as key-values:</p>
</li>
</ol>
<ul>
<li>Add <code>FoundationaLLM:APIs:GatekeeperAPI:Configuration:EnableAzureContentSafetyPromptShield</code></li>
<li>Add <code>FoundationaLLM:APIs:GatekeeperAPI:Configuration:EnableLakeraGuard</code></li>
<li>Add <code>FoundationaLLM:APIs:GatekeeperAPI:Configuration:EnableEnkryptGuardrails</code></li>
<li>Rename <code>FoundationaLLM:AzureContentSafety:APIKey</code> in <code>FoundationaLLM:APIs:Gatekeeper:AzureContentSafety:APIKey</code></li>
<li>Rename <code>FoundationaLLM:AzureContentSafety:APIUrl</code> in <code>FoundationaLLM:APIs:Gatekeeper:AzureContentSafety:APIUrl</code></li>
<li>Rename <code>FoundationaLLM:AzureContentSafety:HateSeverity</code> in <code>FoundationaLLM:APIs:Gatekeeper:AzureContentSafety:HateSeverity</code></li>
<li>Rename <code>FoundationaLLM:AzureContentSafety:SelfHarmSeverity</code> in <code>FoundationaLLM:APIs:Gatekeeper:AzureContentSafety:SelfHarmSeverity</code></li>
<li>Rename <code>FoundationaLLM:AzureContentSafety:SexualSeverity</code> in <code>FoundationaLLM:APIs:Gatekeeper:AzureContentSafety:SexualSeverity</code></li>
<li>Rename <code>FoundationaLLM:AzureContentSafety:ViolenceSeverity</code> in <code>FoundationaLLM:APIs:Gatekeeper:AzureContentSafety:ViolenceSeverity</code></li>
<li>Add <code>FoundationaLLM:APIs:Gatekeeper:LakeraGuard:APIKey</code></li>
<li>Add <code>FoundationaLLM:APIs:Gatekeeper:LakeraGuard:APIUrl</code></li>
<li>Add <code>FoundationaLLM:APIs:Gatekeeper:EnkryptGuardrails:APIKey</code></li>
<li>Add <code>FoundationaLLM:APIs:Gatekeeper:EnkryptGuardrails:APIUrl</code></li>
</ul>
<ol start="16">
<li><p>The following Key Vault secret is needed:</p>
<ul>
<li><code>lakera-guard-api-key</code></li>
<li><code>enkrypt-guardrails-apikey</code></li>
</ul>
</li>
</ol>

</article>

        <div class="contribution d-print-none">
          <a href="https://github.com/solliancenet/foundationallm/blob/main/docs/release-notes/breaking-changes.md/#L1" class="edit-link">Edit this page</a>
        </div>

        <div class="next-article d-print-none border-top" id="nextArticle"></div>

      </div>

      <div class="affix">
        <nav id="affix"></nav>
      </div>
    </main>

    <div class="container-xxl search-results" id="search-results"></div>

    <footer class="border-top text-secondary">
      <div class="container-xxl">
        <div class="flex-fill">
          © FoundationaLLM. All rights reserved. | Find out more about FoundationaLLM at <a href="https://foundationallm.ai">foundationallm.ai</a>.
        </div>
      </div>
    </footer>
  </body>
</html>
